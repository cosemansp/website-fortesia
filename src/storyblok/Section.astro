---
import { storyblokEditable, renderRichText } from "@storyblok/astro";
import markdownIt from "markdown-it";
import slugify from "slugify";
import { splitHtmlStringPerPTag } from "../utils/html";

const { blok } = Astro.props;
const md = markdownIt();
const html = md.render(blok.text);

const amountOfParagraphs = Number(blok.amountOfParagraphs ?? 100);
const paragraphs = splitHtmlStringPerPTag(html);
const itCanOverflow = paragraphs.length > amountOfParagraphs;
const beginText = itCanOverflow ? paragraphs.slice(0, amountOfParagraphs - 1).join(" ") : html;
const endText = paragraphs.slice(amountOfParagraphs - 1).join(" ");

// console.log("blok - section", { beginText, endText });

// const renderedRichText = renderRichText(blok.content);
console.log("blok - section", {blok, amountOfParagraphs});
---

<article {...storyblokEditable(blok)}>
  <section
    id={slugify(blok.title || "section", { lower: true })}
    class="slide section-active"
    data-stellar-background-ratio="0.5"
    style={`background: url("${blok.background}") 0px 693.824px repeat;`}
  >
    <div class="container">
      <hgroup>
        <h1>{blok.title}</h1>
      </hgroup>
      <div class="separator"></div>
      
      <div class="columns-1 md:columns-2">
        <span set:html={beginText} />
        <span class="hidden" id="more-text" set:html={endText} />
      </div>
      {itCanOverflow && (
        <span id="toggle-btn" class="underline cursor-pointer">meer...</span>
        <span id="hide-btn" class="hidden underline cursor-pointer">minder</span>
      )}
    </div>
  </section>
</article>

<script>
  const moreTextEl = document.getElementById("more-text");
  const toggleBtnEl = document.getElementById("toggle-btn");
  const hideBtnEl = document.getElementById("hide-btn");

  toggleBtnEl.addEventListener("click", () => {
    moreTextEl.classList.toggle("hidden");
    toggleBtnEl.classList.toggle("hidden");
    hideBtnEl.classList.toggle("hidden");
  });

  hideBtnEl.addEventListener("click", () => {
    moreTextEl.classList.toggle("hidden");
    toggleBtnEl.classList.toggle("hidden");
    hideBtnEl.classList.toggle("hidden");
  });
</script>
